#!/bin/bash
# Generates an SHA1 hash for directories or files.  Hashes generated for folders
# should only be compared if generated by this script.  Directories with name
# beginning with "." are ignored.

if [[ $# -eq 0 ]]
then
	echo "Usage: $0 path [...]"
	exit
fi

for path in "$@"
do
	if [[ -d $path ]]
	then
		# Get list of hashes for each file and then hash the list -- includes
		# filenames, so moved, but identical files results in different hash

		cd "$path"
		sha=`find -type d -regex ".*/\..*" -prune -o -type f -print | sed 's/^\|$/"/g' | xargs sha1sum | sort | sha1sum`
		cd - > /dev/null

		echo ${sha/-/$path}
	else
		echo `sha1sum $path`
	fi
done
